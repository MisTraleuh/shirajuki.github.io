<!doctype html>
<html>
	<head>
		<title>Fiskemiddager</title>
		<meta charset="utf-8" />
		<link href="stil.css" rel="stylesheet" type="text/css">
		<script>
		/*
		Middagene for uke 26 i 2016 ser slik ut:
		Middag 1: Sørlandsk *KRABBE suppe
		Middag 2: Mandals *TORSK i smørsaus med Holumspoteter
		Middag 3: *LAKS fra Laudal i spinat (bare for dem som har bestilt tre middager)
		*/
		const meny = [
			{uke: 26, middag: ['krabbe','torsk','laks']}
		];
		const raavarePris = [
			{person: 'barn', torsk: 200, sei: 200, makrell: 200, reker: 250, krabbe: 300, laks: 200}, //barn
			{person: 'ungdom', torsk: 300, sei: 300, makrell: 300, reker: 500, krabbe: 500, laks: 300}, //ungdom
			{person: 'voksne', torsk: 350, sei: 350, makrell: 350, reker: 500, krabbe: 600, laks: 350} //voksne
		];
		function raavarerReset() {
			return {torsk: 0, sei: 0, makrell: 0, reker: 0, krabbe: 0, laks: 0};
		}
		let raavarer = raavarerReset();
		let ukeNr = 0;
		let bestillingstabell = [
			[26,2,1,1,2],
			[26,3,0,2,2],
			[26,2,0,0,1],
			[26,3,0,0,2],
			[27,2,1,1,2],
			[27,2,1,1,2]
		];
		// Load DOM
		let table, btn;
		let form;
		window.onload = () => {
			table = document.getElementById('table');
			btn = document.getElementById('btn');
			btnSjekkUke = document.getElementById('btnSjekkUke');
			form = document.getElementsByClassName('info');
			sjekkUke = document.getElementById('ukeNr');
			btn.onclick = leggTil;
			btnSjekkUke.onclick = () => {
				ukeNr = sjekkUke.value;
				beregnTotalbehovFisk(ukeNr)
			};
			ukeNr = sjekkUke.value;
			tegnTabell(bestillingstabell,table);
			beregnTotalbehovFisk(ukeNr);
		}
		function beregnTotalbehovFisk(ukeNr) {
			raavarer = raavarerReset();
			// Henter meny for uken
			let ukeMeny = [];
			let sjekkOmUkeFinnes = false;
			for (let i = 0; i < meny.length; i++) {
				if (ukeNr == meny[i].uke) {
					ukeMeny = meny[i].middag;
					sjekkOmUkeFinnes = true;
					break;
				}
			}
			// Sjekk om den finner uke nr. eller ikke
			if (!sjekkOmUkeFinnes) return alert(`Finner ikke meny for uke nr. ${ukeNr} i dataene`);
			// Sjekk om liste er tom:
			if (bestillingstabell.length == 0) return alert(`Tom liste!`);
			// beregnings loop her
			for (let i = 0; i < bestillingstabell.length; i++) {
				// finner ut ukeNr, middag, personer og valgtUkeMeny her
				let rad = bestillingstabell[i];
				if (rad[0] == ukeNr) {
					let middag = rad[1];
					let personer = [];
					for (let j = 2; j < rad.length; j++) {
						personer.push(rad[j]);
					}
					valgtUkeMeny = ukeMeny.concat().splice(0,middag); // velger antall varer fra middagstypen, 2 eller 3 gjennom en kopi av hele menyen
					//console.log({ukeNr, middag, personer,valgtUkeMeny})
					// Beregning skjer her:
					for (let i = 0; i < personer.length; i++) {
						for (let j = 0; j < valgtUkeMeny.length; j++) {
							// Tar den outputte varablen raavarer og legger til den respektive fiskens pris med pris ut fra raavarePris ganget med antall personer
							raavarer[valgtUkeMeny[j]] += raavarePris[i][valgtUkeMeny[j]]*personer[i];
							//console.log('%c'+raavarer[valgtUkeMeny[j]],'color: red')
						}
					}
					//console.log(raavarer)
					// Skriver ut her:
					let keys = Object.keys(raavarer);
					let values = Object.values(raavarer);
					let output = document.getElementById('output')
					output.innerHTML = '';
					for (let i = 0; i < keys.length; i++) {
						output.innerHTML += `<p>${keys[i]}: ${values[i]}g</p>`;
					}
				}
			}
		}
		function slettTabell(obj) {
			while (obj.childElementCount > 1) {
				obj.removeChild(obj.lastChild);
			}
			beregnTotalbehovFisk(ukeNr);
		}
		function sortTabell(arr) {
			arr.sort((a,b) => a[0] - b[0]);
		}
		function tegnTabell(arr,output) {
			for (let i = 0; i < arr.length; i++) {
				let tr = document.createElement('tr');
				for (let j = 0; j < arr[i].length; j++) {
					let td = document.createElement('td');
					td.innerHTML = arr[i][j];
					tr.appendChild(td);
					if (j == arr[i].length-1) {
						let slett = document.createElement('td');
						slett.innerHTML = 'slett';
						slett.id = i;
						slett.className = 'slett';
						slett.onclick = function() {
							arr.splice(this.id,1);
							slettTabell(table);
							tegnTabell(bestillingstabell,table);
						}
						tr.appendChild(slett);
					}
				}
				output.appendChild(tr);
			}
		}
		function leggTil() {
			let godkjentVerdi = true;
			let verdi = 0;
			let tabellVerdi = [];
			for (let i = 0; i < form.length; i++) {
				verdi = parseInt(form[i].value);
				tabellVerdi.push(verdi);
				if (isNaN(verdi) || verdi < 0) godkjentVerdi = false;
			}

			if (godkjentVerdi) {
				slettTabell(table);
				bestillingstabell.push(tabellVerdi);
				sortTabell(bestillingstabell);
				tegnTabell(bestillingstabell,table);
				beregnTotalbehovFisk(ukeNr);
			}
		}
		</script>
	</head>
	<body>
		<header>
			<p><a href="index.html">Eksamensoppgave H2016</a></p>
		</header>
		<br>
		<main id="main">
			<div>
				<h3>Råvaretabell:</h3>
				<img src="ravaretabell.PNG" alt="">
				<h3>Bestillingstabell:</h3>
				<table id="table">
					<tr>
						<th>Uke nr.</th>
						<th>Antall middager</th>
						<th>Barn</th>
						<th>Ungdom</th>
						<th>Voksen</th>
					</tr>
				</table>
				<br>
				<form onsubmit="return false">
					<input class="info" type="number" placeholder="Uke nr." value="" min="1" max="60" required>
					<br>
					<select class="info" required>
							<option disabled value>Velg hvor matkasse type for antall middager</option>
							<option value="2">Matkasse m. 2 middager</option>
							<option value="3">Matkasse m. 3 middager</option>
					</select>
					<br>
						<input class="info" type="number" placeholder="Antall barn" min="0" value="" required><br>
						<input class="info" type="number" placeholder="Antall ungdom" min="0" value="" required><br>
						<input class="info" type="number" placeholder="Antall voksne" min="0" value="" required><br>
					<button id="btn">Legg til!</button>
				</form>
				<p>NB! det er bare uke nr. 26 som funker! Siden det er det eneste som har gitt data.</p>
				Velg å vis beregning for hvert fiskeslag i uke nr: <input id="ukeNr" type="number" name="small" value="26">
				<button id="btnSjekkUke" name="small">Sjekk uke!</button>
				<div id="output">
				</div>
				<br>
			</div>
		</main>
	</body>
</html>
