<!doctype html>
<html>
	<head>
		<title>Lektorstudie</title>
		<meta charset="utf-8" />
		<link href="stil.css" rel="stylesheet" type="text/css">
		<style media="screen">
			input[type="radio"] {
				display: none;
			}
		</style>
		<script>
			// Array-liste over ulike fag som kan velges imellom
			let studier = [
				"Engelsk",
				"Geografi",
				"Historie Vg3",
				"Kroppsøving Vg3",
				"Naturfag",
				"Matematikk Vg1, Vg2 (eller x fag)",
				"Norsk hovedmål, skriftlig Vg3",
				"Norsk sidemål, skriftlig Vg3",
				"Norsk, muntlig Vg3",
				"Religion og etikk",
				"Samfunnsfag i videregående opplæring",
				"Matte R1",
				"Matte R2",
				"Fysikk1",
				"Fysikk2",
				"Informasjonsteknologi 1",
				"Informasjonsteknologi 2",
				"Programmering og Modellering"
			];
			// Loader DOM-events
			let table, nodes;
			window.onload = () => {
				document.getElementById('btn').onclick = beregn;
				table = document.getElementById('table');
				printTable(table, studier);
				nodes = document.querySelectorAll('input[type="radio"]');
			}
			// Funksjon for å tegne inn tabellene av inputs
			function printTable(output, arr) {
				output.innerHTML += `
				<tr style='font-weight: bold;'>
					<td>Studiefag</td>
					<td>Karakter</td>
					<td>Eksamenskarakter</td>
				</tr>`;
				for (let i = 0; i < arr.length; i++) {
					let input1 = '';
					let input2 = '';
					for (let j = 1; j <= 6; j++) {
						input1 += `
						<input id='${i}-k-${j}' type='radio' name='${i}-k'/>
						<label for='${i}-k-${j}' onclick='()=>checkClick(${i}-k-${j})'>${j}</label>`;
					}
					for (let j = 1; j <= 6; j++) {
						input2 += `
						<input id='${i}-e-${j}' type='radio' name='${i}-e'/>
						<label for='${i}-e-${j}' onclick='()=>checkClick(${i}-e-${j})'>${j}</label>`;
					}
					output.innerHTML += `
					<tr>
						<td id='${i}'>${arr[i]}</td>
						<td>${input1}</td>
						<td>${input2}</td>
					</tr>`;
				}
			}
			// Sjekker for hvert click av inputtene, om den er allerede sjekket, tar vekk sjekk
			function checkClick(id) {
				let node = document.getElementById(id);
				if (node.checked) {
					setTimeout(() => node.checked = false,100);
				}
			}
			// Funksjon for å skrive ut melding gitt ved parameterne id og melding
			function printMelding(id,melding) {
				document.getElementById(id).innerHTML = melding;
			}
			// Funksjon for beregning av data og utregning.
			function beregn() {
				printMelding('output','');
				let tillegg = parseFloat(document.getElementById('tillegg').value)

				let data = []
				let antall = 0;
				let poengSum = 0;

				for (let i = 0; i < nodes.length; i++) {
					if (nodes[i].checked) {
						let name = nodes[i].name.split('-');
						let id = nodes[i].id.split('-');
						//console.log(`%c${id[0]}`,'color: red;')
						let tempFag = (id[1] == 'k') ? (studier[name[0]]) : (studier[name[0]]+' [Eksamen]');
						data.push({ 'fag': tempFag,'poeng': parseInt(id[2]) });
					}
				}
				data = data.sort((a, b) => b.poeng - a.poeng);
				let melding = '';
				for (let i = 0; i < data.length; i++) {
					melding += `${data[i].fag} - ${data[i].poeng}<br/>`;
					poengSum += data[i].poeng;
					antall++;
				}
				poengSum = poengSum/antall
				if (tillegg > 4 || tillegg < 0 || isNaN(tillegg)) return printMelding('output',`Feil input i tillegg!`);
				if (data.length !== 0) {
					melding2 = `karakter: ${poengSum.toFixed(2)} - Tilleggspoeng: ${tillegg} - Studiepoeng: ${((poengSum*10) + tillegg).toFixed(2)}`;
					printMelding('output',`${melding}<br/>${melding2}`);
				}
			}
		</script>
	</head>
	<body>
		<header>
			<p><a href="index.html">Eksamensoppgave H2015</a></p>
		</header>
		<br>
		<main>
			<div class="">
				<table id="table">
				</table>
				<br/>
				Tilleggspoeng (0 - 4): <input type="number" id="tillegg" value="0" min='0' max='4' step='0.5'>
				<button id="btn">Beregn studiepoeng!</button>
				<p style="text-align: left;"id="output"></p>
			</div>
		</main>
	</body>
</html>
