<!doctype html>
<html>
	<head>
		<title>Museum</title>
		<meta charset="utf-8" />
		<link href="stil.css" rel="stylesheet" type="text/css">
		<script>
		const instrument = [
			{navn: 'fagott', lydDirectory: 'vedlegg/fagott.mp3', bilde:'vedlegg/fagott.jpg', type: 'true'},
			{navn: 'fløyte', lydDirectory: 'vedlegg/floyte.mp3', bilde:'vedlegg/floyte.jpg', type: 'true'},
			{navn: 'klarinett', lydDirectory: 'vedlegg/klarinett.mp3', bilde:'vedlegg/klarinett.jpg', type: 'true'},
			{navn: 'obo', lydDirectory: 'vedlegg/obo.mp3', bilde:'vedlegg/obo.jpg', type: 'true'},
			{navn: 'valthorn', lydDirectory: 'vedlegg/valthorn.mp3', bilde:'vedlegg/valthorn.jpg', type: 'true'}
		];
		const sysLyd = ['vedlegg/feil.mp3','vedlegg/riktig.mp3'];
		let tilfeldigtall = -1, forsoek = 0;
		let instrmenter, audio;
		let gameOver = false, playAudio = true;
		window.onload = () => {
			instrumenter = document.getElementById('instrument');
			let print = document.getElementById('print');
			tegnElementer(instrument,instrumenter,print);

			let button = document.createElement('button');
			button.onclick = () => spillTilfeldigLyd();
			button.id = 'btn';
			button.innerHTML = 'Spill tilfeldig lyd!';
			print.appendChild(button);

			if (typeof(Storage) !== "undefined") {
			 console.log("ready")
			}
		}
		function tegnElementer(objArr,output1) {
			for (var i = 0; i < objArr.length; i++) {
				let bilde = document.createElement('img');
				bilde.id = i;
				bilde.src = objArr[i].bilde;
				bilde.onclick = function() {
					gjett(this.id);
				}
				if (objArr[i].type) output1.appendChild(bilde);
			}
		}

		function getRndInteger(fra, til) {
			return Math.floor(Math.random()*(til-fra+1))+fra;
		}
		function spillLyd(dir) {
			audio = new Audio(dir);
			audio.load();
			audio.play();
		}
		function spillTilfeldigLyd() {
			if (tilfeldigtall == -1 && !gameOver) {
				tilfeldigtall = getRndInteger(0,instrument.length-1);
				while (!instrument[tilfeldigtall].type) tilfeldigtall = getRndInteger(0,instrument.length-1);
			}
			if (playAudio) {
				spillLyd(instrument[tilfeldigtall].lydDirectory);
				playAudio = false;
				setTimeout(() => {
					audio.pause();
					playAudio = true;
				},5000);
				console.log(tilfeldigtall)
			}
		}
		function skrivUt(tekst,type=0) {
			if (type == 0) {
				document.getElementById('output').innerHTML = '';
			}
			document.getElementById('output').innerHTML += tekst;
		}
		function reset(obj) {
			obj.innerHTML = '';
		}
		function gjett(id) {
			if (playAudio && tilfeldigtall !== -1) {
				if (id == tilfeldigtall) {
					spillLyd(sysLyd[1]);
					instrument[id].type = false;
					tilfeldigtall = -1;
					reset(instrumenter);
					tegnElementer(instrument,instrumenter,print);
				} else {
					spillLyd(sysLyd[0]);
					forsoek++;
				}
				skrivUt(`Antall (feil)forsøk: ${forsoek}`)

				gameOver = true;
				for (var i = 0; i < instrument.length; i++) {
					if (instrument[i].type) gameOver = false;
				}
				if (gameOver) {
					lagreHighschore(forsoek)
				}
			}
		}
		function lagreHighschore(value) {
			document.getElementById('btn').disabled = true;
			if (typeof(localStorage.museum) == "undefined") {
				localStorage.museum = JSON.stringify(new Array());
			}
			// localStorage.removeItem("museum");
			let scores = JSON.parse(localStorage.museum);
			let topScore = scores[0];
			scores.push(value);
			scores.sort((a, b) => a - b);
			console.log(localStorage,scores)
			if (scores.length > 9) scores.splice(10,1);
			skrivUt('');
			if (value == 0) skrivUt('<br/><strong>Gratulerer 0 feil!</strong><br/>',1);
			if (topScore == value) {
				skrivUt('<br/><strong>SAMME HIGHSCORE!</strong><br/>',1);
			} else if (value == scores[0]) {
				skrivUt('<br/><strong>NY HIGHSCORE!</strong><br/>',1);
			}
			skrivUt('<br/>Highscore:<br/>',1);
			for (var i = 0; i < scores.length; i++) {
				skrivUt(`${i+1}.score: ${scores[i]}<br/>`,1);
			}
			localStorage.museum = JSON.stringify(scores);
		}
		</script>
	</head>
	<body>
		<header>
			<p><a href="index.html">Eksamensoppgave V2018</a></p>
		</header>
		<br>
		<main>
			<br>
			<h2>Applikasjon for å teste kunnskap om blåseinstrumenter</h2>
			<p>I tabellen under ser du en oversikt over noen arrangementer i juni 2018. </p>
			<div id="print">
				<div id="instrument">
				</div>
				<br/>
			</div>
			<p id="output"></p>
		</main>
		<br>
	</body>
</html>
