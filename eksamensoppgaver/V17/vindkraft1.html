<!doctype html>
<html>
	<head>
		<title>Vindkraft -  Oppgave 1</title>
		<meta charset="utf-8" />
		<link href="css/hovedstil.css" rel="stylesheet" type="text/css">
		<style media="screen">
			.imgBox {
				background: url("vedlegg/landskap.jpg") no-repeat;
				background-size: 100% 100%;
				width: 500px;
				height: 300px;
				position: relative;
				overflow: hidden;
			}
			.imgBox img {
				position: absolute;
			}
			#stang {
				bottom: 30px;
				right: 120px;
				height: 170px;
			}
			#vifte {
				top: 0px;
				right: 24px;
				height: 200px;
			}
			.blad {
				background: url("vedlegg/blad.png") no-repeat;
				background-size: 100% 100%;
				width: 20px;
				height: 30px;
				position: absolute;
				top: 10px;
				left: 10px;
			}
			@keyframes rotate {
			    from {
			      transform: rotate(0deg);
			    }
			    to {
			      transform: rotate(720deg);
			    }
			}
		</style>
	</head>
	<body>
		<header>
			<p><a href="index.html">⌂ Eksamensoppgave V2017</a> - Oppgave 1: title</p>
		</header>
		<main>
			<br>
			<div class="content">
				<h1>Vindmølle- og væranimasjon</h1>
				<p>
				Applikasjon som viser vindmøllerotasjonen ved gitt vindstyrke
				</p>
				<input type="radio" name="vindstyrke" value="1" checked> Stille (0-0.2 m/s)<br>
				<input type="radio" name="vindstyrke" value="2"> Lett bris (3.4-5.4 m/s)<br>
				<input type="radio" name="vindstyrke" value="3"> Stiv kuling (13.9-17.1 m/s)<br>
				<button id="btn1">Animer</button>
				<button id="btn2">Stopp</button>
				<div class="imgBox">
					<div id='img' style="postion:absolute">
						<img src="vedlegg/vindmøllestang.png" id='stang' alt="">
						<img src="vedlegg/vindmøllevifte.png" id='vifte' alt="">
					</div>
				</div>
			</div>
		</main>
		</br>
		<script type="text/javascript">
			const img = document.getElementById('img');
			const vifte = document.getElementById('vifte');
			const vindLyd = new Audio('vedlegg/sommervind.mp3');
			let blader = [];

			class Blad {
				constructor(x,y,width,height,vx) {
					this.div = document.createElement('div');
					this.div.className = 'blad';
					this.div.style.width = `${width}px`;
					this.div.style.height = `${height}px`;
					img.appendChild(this.div)

					this.x = x;
					this.y = y;
					this.vx = vx;
					this.vy = 0.3;
				}
				show() {
					this.div.style.left = `${this.x}px`
					this.div.style.top = `${this.y}px`
					if (this.x > img.offsetWidth) {
						this.x = -30;
					}
				}
			}
			const radio = document.getElementsByName('vindstyrke');
			window.onload = () => {
				let button1 = document.getElementById('btn1');
				let button2 = document.getElementById('btn2');
				button1.onclick = endreVindstyrke;
				button2.onclick = () => endreVindstyrke(4);
			}
			function randint(min, max) {
				return Math.floor(Math.random() * (max - min + 1) ) + min;
			}
			function slettBlader() {
				while (img.lastChild && img.lastChild.className == 'blad') {
					img.removeChild(img.lastElementChild);
				}
			}
			function endreVindstyrke(x=0) {
				if (x == 4) {
					slettBlader();
					vifte.style.animation = `none`;
				} else {
					for (var i = 0; i < radio.length; i++) {
						if (radio[i].checked) x = radio[i].value;
					}
					slettBlader()
					// console.log(x)
					if (x > 0) {
						if (x == 1) {
							vindLyd.volume = 0.5;
						} else {
							vindLyd.volume = 1;
						}
						vindLyd.load();
						vindLyd.play();
					}
					vifte.style.animation = `rotate ${3/x}s 0s linear infinite`;
					for (var i = 0; i < 7*x; i++) {
						blader.push(new Blad(randint(-300,-30),randint(200,270),20,30,(randint(10,20)*x)/10))
					}
				}
			}
			function draw() {
				for (var i = 0; i < blader.length; i++) {
					let blad = blader[i];
					blad.x += blad.vx;
					blad.y += blad.vy * randint(-1,1);
					blad.show();
				}
				requestAnimationFrame(draw);
			}
			draw();
		</script>
	</body>
</html>
